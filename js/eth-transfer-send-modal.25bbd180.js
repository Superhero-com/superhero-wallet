"use strict";(self["webpackChunksuperhero_wallet"]=self["webpackChunksuperhero_wallet"]||[]).push([[551],{27702:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var r=n(20641);function a(e,t,n,a,o,u){var s=(0,r.g2)("TransferSendBase");return(0,r.uX)(),(0,r.Wv)(s,{"current-step":e.currentStep,"sending-disabled":e.error||!e.transferData.address||!e.transferData.amount,onClose:e.resolve,onStepNext:e.proceedToNextStep,onStepPrev:e.editTransfer},{content:(0,r.k6)((function(){return[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.currentStepConfig.component),{ref:"currentRenderedComponent",transferData:e.transferData,"onUpdate:transferData":t[0]||(t[0]=function(t){return e.transferData=t}),onSuccess:e.currentStepConfig.onSuccess,onError:t[1]||(t[1]=function(t){return e.error=t})},null,40,["transferData","onSuccess"]))]})),_:1},8,["current-step","sending-disabled","onClose","onStepNext","onStepPrev"])}var o=n(1287),u=n(50953),s=n(65563),l=n(84754),i=n(42346);function c(e,t,n,a,o,u){var s=(0,r.g2)("TokenAmount"),l=(0,r.g2)("DetailsItem"),i=(0,r.g2)("TransferReviewBase");return(0,r.uX)(),(0,r.Wv)(i,{"base-token-symbol":e.ETH_COIN_SYMBOL,"transfer-data":e.transferData,loading:e.loading,protocol:e.PROTOCOLS.ethereum,"show-fiat":e.isSelectedAssetEthCoin,class:"transfer-review"},{total:(0,r.k6)((function(){return[e.isSelectedAssetEthCoin?((0,r.uX)(),(0,r.Wv)(l,{key:0,label:e.$t("common.total"),class:"details-item"},{value:(0,r.k6)((function(){return[(0,r.bF)(s,{amount:+e.transferData.total,symbol:e.ETH_COIN_SYMBOL,protocol:e.PROTOCOLS.ethereum,"data-cy":"review-total","high-precision":""},null,8,["amount","symbol","protocol"])]})),_:1},8,["label"])):(0,r.Q3)("",!0)]})),_:1},8,["base-token-symbol","transfer-data","loading","protocol","show-fiat"])}var d=n(2327),f=(n(44114),n(2892),n(26099),n(75220)),v=n(46992),m=n(32118),p=n(7595),x=n(60831),h=n(74494),S=n(39953),A=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function u(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?n(e.value):a(e.value).then(u,s)}l((r=r.apply(e,t||[])).next())}))};const P=(0,r.pM)({name:"EthTransferReview",components:{TokenAmount:S.A,DetailsItem:h.A,TransferReviewBase:x.A},model:{prop:"transferData"},props:{transferData:{type:Object,required:!0}},setup:function(e,t){var n=t.emit,a=(0,v.s9)(),o=a.t,i=(0,f.rd)(),c=(0,l.mv)(),x=c.homeRouteName,h=(0,l.U8)(),S=h.openDefaultModal,P=(0,l.oV)(),b=P.getLastActiveProtocolAccount,y=(0,l.rb)(),T=y.addAccountPendingTransaction,O=(0,u.KR)(!1),g=m.C.getAdapter(s.yv.ethereum),w=(0,r.EW)((function(){var t,n;return(null===(n=null===(t=e.transferData)||void 0===t?void 0:t.selectedAsset)||void 0===n?void 0:n.contractId)===g.coinContractId}));function C(e){S({title:o("modals.transaction-failed.msg"),icon:"critical",msg:e})}function k(){var t;return A(this,void 0,void 0,(0,d.A)().mark((function r(){var a,o,u,l,c,f,v;return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=e.transferData,o=a.amount,u=a.address,l=a.selectedAsset,o&&u&&l){r.next=3;break}return r.abrupt("return");case 3:if(O.value=!0,f=b(s.yv.ethereum),r.prev=5,w.value){r.next=12;break}return r.next=9,null===(t=g.transferToken)||void 0===t?void 0:t.call(g,Number(o),u,l.contractId,{fromAccount:null===f||void 0===f?void 0:f.address,maxPriorityFeePerGas:e.transferData.maxPriorityFeePerGas,maxFeePerGas:e.transferData.maxFeePerGas});case 9:c=r.sent,r.next=15;break;case 12:return r.next=14,g.spend(Number(o),u,{fromAccount:null===f||void 0===f?void 0:f.address,maxPriorityFeePerGas:e.transferData.maxPriorityFeePerGas,maxFeePerGas:e.transferData.maxFeePerGas});case 14:c=r.sent;case 15:c&&(v={hash:c.hash,pending:!0,transactionOwner:null===f||void 0===f?void 0:f.address,protocol:s.yv.ethereum,tx:{amount:Number(o),callerId:null===f||void 0===f?void 0:f.address,contractId:l.contractId,senderId:null===f||void 0===f?void 0:f.address,type:w.value?"SpendTx":"ContractCallTx",function:"transfer",recipientId:u,arguments:[],fee:0}},T(null===f||void 0===f?void 0:f.address,v)),r.next=22;break;case 18:throw r.prev=18,r.t0=r["catch"](5),C(r.t0.message),r.t0;case 22:return r.prev=22,O.value=!1,r.finish(22);case 25:i.push({name:x.value}),n("success");case 27:case"end":return r.stop()}}),r,null,[[5,18,22,25]])})))}return{PROTOCOLS:s.yv,ETH_COIN_SYMBOL:p.xU,loading:O,isSelectedAssetEthCoin:w,submit:k}}});var b=n(66262);const y=(0,b.A)(P,[["render",c],["__scopeId","data-v-038e842f"]]),T=y;n(76918),n(23288),n(38781);var O=n(53751);function g(e,t,n,a,o,u){var s=(0,r.g2)("TransferSendRecipient"),l=(0,r.g2)("BtnMaxAmount"),i=(0,r.g2)("TransferSendAmount"),c=(0,r.g2)("TransactionSpeedPicker"),d=(0,r.g2)("DetailsItem"),f=(0,r.g2)("TransferSendFormBase");return(0,r.uX)(),(0,r.Wv)(f,(0,r.v6)(e.$attrs,{"transfer-data":e.transferData,fee:e.numericFee,"fee-symbol":e.ETH_COIN_SYMBOL,protocol:e.PROTOCOLS.ethereum,"custom-title":e.$t("modals.send.sendAsset",{name:e.ETH_COIN_NAME}),class:"transfer-send-form"}),{recipient:(0,r.k6)((function(){return[(0,r.bF)(s,{modelValue:e.formModel.address,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formModel.address=t}),modelModifiers:{trim:!0},placeholder:e.recipientPlaceholderText,errors:e.errors,protocol:e.PROTOCOLS.ethereum,"validation-rules":{account_address:[e.PROTOCOLS.ethereum]},onOpenQrModal:e.openScanQrModal},null,8,["modelValue","placeholder","errors","protocol","validation-rules","onOpenQrModal"])]})),amount:(0,r.k6)((function(){return[(0,r.bF)(i,{modelValue:e.formModel.amount,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.formModel.amount=t}),errors:e.errors,"selected-asset":e.formModel.selectedAsset,protocol:e.PROTOCOLS.ethereum,"validation-rules":Object.assign(Object.assign({},+e.balance.minus(e.fee)>0?{max_value:e.max}:{}),{enough_coin:[e.fee.toString(),e.ETH_COIN_SYMBOL]}),onAssetSelected:e.handleAssetChange},{"label-after":(0,r.k6)((function(){var t,n;return[(0,r.bF)(l,{"is-max":(null===(n=null===(t=e.formModel)||void 0===t?void 0:t.amount)||void 0===n?void 0:n.toString())===e.max,onClick:e.setMaxAmount},null,8,["is-max","onClick"])]})),_:1},8,["modelValue","errors","selected-asset","protocol","validation-rules","onAssetSelected"])]})),extra:(0,r.k6)((function(){return[(0,r.bo)((0,r.bF)(d,{label:e.$t("modals.send.transactionSpeed")},{value:(0,r.k6)((function(){return[(0,r.bF)(c,{modelValue:e.feeSelectedIndex,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.feeSelectedIndex=t}),"fee-list":e.feeList},null,8,["modelValue","fee-list"])]})),_:1},8,["label"]),[[O.aG,e.activeNetwork.type!==e.NETWORK_TYPE_TESTNET]])]})),_:1},16,["transfer-data","fee","fee-symbol","protocol","custom-title"])}n(28706),n(50113),n(9868);var w=n(37061),C=n(38653),k=n(60346),E=n(28388),F=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function u(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?n(e.value):a(e.value).then(u,s)}l((r=r.apply(e,t||[])).next())}))},I={slow:1,medium:1.5,fast:2};function D(){var e=(0,E.G)(),t=e.ethActiveNetworkSettings,n=(0,v.s9)(),a=n.t,o=(0,u.KR)(0),s=(0,u.KR)(new k.A(0)),l=(0,u.KR)(new k.A(0)),i=(0,u.KR)(new k.A(0)),c=(0,r.EW)((function(){return l.value.multipliedBy(I.slow)})),f=(0,r.EW)((function(){return l.value.multipliedBy(I.medium)})),m=(0,r.EW)((function(){return l.value.multipliedBy(I.fast)})),x=(0,r.EW)((function(){return[{fee:s.value.plus(c.value).multipliedBy(p.un),time:300,label:a("common.transferSpeed.slow"),maxPriorityFee:c.value,maxFeePerGas:i.value.plus(c.value)},{fee:s.value.plus(f.value).multipliedBy(p.un),time:180,label:a("common.transferSpeed.medium"),maxPriorityFee:f.value,maxFeePerGas:i.value.plus(f.value)},{fee:s.value.plus(m.value).multipliedBy(p.un),time:30,label:a("common.transferSpeed.fast"),maxPriorityFee:m.value,maxFeePerGas:i.value.plus(m.value)}]})),h=(0,r.EW)((function(){return x.value[o.value].fee})),S=(0,r.EW)((function(){return x.value[o.value].maxFeePerGas})),A=(0,r.EW)((function(){return x.value[o.value].maxPriorityFee}));function P(){return F(this,void 0,void 0,(0,d.A)().mark((function e(){var n,r,a;return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.value.nodeUrl,r=new w.PT(n),e.next=4,r.calculateFeeData();case 4:a=e.sent,s.value=new k.A((0,C.kX)(a.baseFeePerGas,"ether")),i.value=new k.A((0,C.kX)(a.maxFeePerGas,"ether")),l.value=new k.A((0,C.kX)(a.maxPriorityFeePerGas,"ether"));case 8:case"end":return e.stop()}}),e)})))}return{fee:h,feeList:x,feeSelectedIndex:o,maxFeePerGas:S,maxPriorityFeePerGas:A,updateFeeList:P}}var _=n(92350),M=n(31189);function N(e){var t=e.formModel,n=e.fee,a=(0,l.ty)(),o=a.balance,u=(0,r.EW)((function(){var e,n,r=m.C.getAdapter(s.yv.ethereum);return(null===(n=null===(e=t.value)||void 0===e?void 0:e.selectedAsset)||void 0===n?void 0:n.contractId)===r.coinContractId})),i=(0,r.EW)((function(){var e,n;return new k.A((0,M.Y9)(null===(e=t.value.selectedAsset)||void 0===e?void 0:e.amount,-((null===(n=t.value.selectedAsset)||void 0===n?void 0:n.decimals)||-0))||0)})),c=(0,r.EW)((function(){if(o.value&&u.value){var e=o.value.minus(n.value);return(e.isPositive()?e:0).toString()}return i.value.toString()}));return{max:c}}var R=n(6162),B=n(43863),G=n(40477),W=n(14117),L=n(70654),j=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function u(e){try{l(r.next(e))}catch(t){o(t)}}function s(e){try{l(r["throw"](e))}catch(t){o(t)}}function l(e){e.done?n(e.value):a(e.value).then(u,s)}l((r=r.apply(e,t||[])).next())}))};const V=(0,r.pM)({name:"EthTransferSendForm",components:{BtnMaxAmount:L.A,TransactionSpeedPicker:W.A,DetailsItem:h.A,TransferSendAmount:G.A,TransferSendRecipient:B.A,TransferSendFormBase:R.A},model:{prop:"transferData"},props:{transferData:{type:Object,required:!0}},emits:["update:transferData","success","error"],setup:function(e,t){var n=t.emit,a=(0,f.lq)(),o=(0,v.s9)(),u=o.t,i=(0,l.fI)(),c=i.activeNetwork,x=(0,l.ZN)(),h=x.marketData,S=(0,l.ty)(),A=S.balance,P=D(),b=P.fee,y=P.feeList,T=P.feeSelectedIndex,O=P.maxFeePerGas,g=P.maxPriorityFeePerGas,w=P.updateFeeList,C=(0,l.Sr)(),k=C.accountAssets;function E(e,t){return e?k.value.find((function(t){var n=t.contractId;return n===e})):t?void 0:m.C.getAdapter(s.yv.ethereum).getDefaultCoin(h.value,+A.value)}var F=(0,_.x)({transferData:e.transferData,getSelectedAssetValue:E}),I=F.formModel,R=F.errors,B=F.hasError,G=F.invoiceId,W=F.invoiceContract,L=F.openScanQrModal,V=F.handleAssetChange,K=F.updateFormModelValues,Y=(0,r.EW)((function(){return O.value.multipliedBy(p.un)})),X=N({formModel:I,fee:Y}),H=X.max,U=(0,r.EW)((function(){return+b.value.toFixed()})),Q="".concat(u("modals.send.recipientPlaceholderProtocol",{name:s.yv.ethereum})," ").concat(u("modals.send.recipientPlaceholderENS"));function $(){var e,t,a,o=Object.assign(Object.assign({},I.value),{fee:b.value,maxFeePerGas:null===(e=O.value)||void 0===e?void 0:e.toFormat(p.hj),maxPriorityFeePerGas:null===(t=g.value)||void 0===t?void 0:t.toFormat(p.hj),total:U.value+ +((null===(a=I.value)||void 0===a?void 0:a.amount)||0),invoiceId:G.value,invoiceContract:W.value});return n("update:transferData",o),(0,r.dY)()}function q(){return j(this,void 0,void 0,(0,d.A)().mark((function e(){return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(B.value){e.next=4;break}return e.next=3,$();case 3:n("success");case 4:case"end":return e.stop()}}),e)})))}function Z(){I.value.amount=H.value}var z=null;return(0,r.sV)((function(){var t;z=(0,M.mX)((function(){w()}),5e3);var n=a.query;K(Object.assign(Object.assign({},n),{token:n.token||(null===(t=e.transferData.selectedAsset)||void 0===t?void 0:t.contractId)}))})),(0,r.hi)((function(){z&&clearInterval(z)})),(0,r.wB)(B,(function(e){return n("error",e)}),{deep:!0}),(0,r.wB)(I,(function(){$()}),{deep:!0}),{ETH_COIN_NAME:p.Sf,ETH_COIN_SYMBOL:p.xU,PROTOCOLS:s.yv,NETWORK_TYPE_TESTNET:s.Oj,formModel:I,activeNetwork:c,fee:b,feeList:y,recipientPlaceholderText:Q,feeSelectedIndex:T,numericFee:U,errors:R,balance:A,max:H,openScanQrModal:L,handleAssetChange:V,submit:q,setMaxAmount:Z}}}),K=(0,b.A)(V,[["render",g]]),Y=K,X=(0,r.pM)({name:s.iP,components:{TransferSendBase:i.A},props:Object.assign(Object.assign({},i.g),{tokenContractId:{type:String,default:null}}),setup:function(e){var t=(0,l.Y7)(),n=t.getProtocolAvailableTokens,a=(0,r.EW)((function(){return n(s.yv.ethereum)})),i=(0,u.KR)(),c=(0,u.KR)(s.x0.form),d=(0,u.KR)(!1),f=(0,u.KR)({address:e.address,amount:e.amount,payload:e.payload,selectedAsset:e.tokenContractId?a.value[e.tokenContractId]:void 0});function v(){i.value.submit()}function m(){c.value=s.x0.review}function p(){d.value=!1,c.value=s.x0.form}var x=(0,o.A)((0,o.A)({},s.x0.form,{component:Y,onSuccess:m}),s.x0.review,{component:T,onSuccess:e.resolve}),h=(0,r.EW)((function(){return x[c.value]}));return{TRANSFER_SEND_STEPS:s.x0,currentRenderedComponent:i,steps:x,currentStep:c,error:d,transferData:f,currentStepConfig:h,proceedToNextStep:v,editTransfer:p}}}),H=(0,b.A)(X,[["render",a]]),U=H}}]);