"use strict";(self["webpackChunksuperhero_wallet"]=self["webpackChunksuperhero_wallet"]||[]).push([[551],{60601:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r=n(20641);function a(e,t,n,a,o,s){var u=(0,r.g2)("TransferSendBase");return(0,r.uX)(),(0,r.Wv)(u,{"current-step":e.currentStep,"sending-disabled":e.error||!e.transferData.address||!e.transferData.amount,onClose:e.resolve,onStepNext:e.proceedToNextStep,onStepPrev:e.editTransfer},{content:(0,r.k6)((function(){return[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.currentStepConfig.component),{ref:"currentRenderedComponent",transferData:e.transferData,"onUpdate:transferData":t[0]||(t[0]=function(t){return e.transferData=t}),onSuccess:e.currentStepConfig.onSuccess,onError:t[1]||(t[1]=function(t){return e.error=t})},null,40,["transferData","onSuccess"]))]})),_:1},8,["current-step","sending-disabled","onClose","onStepNext","onStepPrev"])}var o=n(41856),s=n(50953),u=n(18743),c=n(12683),i=n(93702);function l(e,t,n,a,o,s){var u=(0,r.g2)("TokenAmount"),c=(0,r.g2)("DetailsItem"),i=(0,r.g2)("TransferReviewBase");return(0,r.uX)(),(0,r.Wv)(i,{"base-token-symbol":e.ETH_COIN_SYMBOL,"transfer-data":e.transferData,loading:e.loading,protocol:e.PROTOCOLS.ethereum,"show-fiat":e.isSelectedAssetEthCoin,class:"transfer-review"},{total:(0,r.k6)((function(){return[e.isSelectedAssetEthCoin?((0,r.uX)(),(0,r.Wv)(c,{key:0,label:e.$t("common.total"),class:"details-item"},{value:(0,r.k6)((function(){return[(0,r.bF)(u,{amount:+e.transferData.total,symbol:e.ETH_COIN_SYMBOL,protocol:e.PROTOCOLS.ethereum,"data-cy":"review-total","high-precision":""},null,8,["amount","symbol","protocol"])]})),_:1},8,["label"])):(0,r.Q3)("",!0)]})),_:1},8,["base-token-symbol","transfer-data","loading","protocol","show-fiat"])}var d=n(34916),f=(n(44114),n(2892),n(26099),n(75220)),v=n(46992),m=n(87087),p=n(92032),h=n(37246),x=n(36069),A=n(7532),S=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function u(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):a(e.value).then(s,u)}c((r=r.apply(e,t||[])).next())}))};const T=(0,r.pM)({name:"EthTransferReview",components:{TokenAmount:A.A,DetailsItem:x.A,TransferReviewBase:h.A},model:{prop:"transferData"},props:{transferData:{type:Object,required:!0}},setup:function(e,t){var n=t.emit,a=(0,v.s9)(),o=a.t,i=(0,f.rd)(),l=(0,c.mv)(),h=l.homeRouteName,x=(0,c.U8)(),A=x.openDefaultModal,T=(0,c.oV)(),g=T.getLastActiveProtocolAccount,O=(0,c.rb)(),b=O.addAccountPendingTransaction,C=(0,s.KR)(!1),P=m.C.getAdapter(u.yv.ethereum),k=(0,r.EW)((function(){var t,n;return(null===(n=null===(t=e.transferData)||void 0===t?void 0:t.selectedAsset)||void 0===n?void 0:n.contractId)===P.coinContractId}));function w(e){A({title:o("modals.transaction-failed.msg"),icon:"critical",msg:e})}function y(){var t;return S(this,void 0,void 0,(0,d.A)().mark((function r(){var a,o,s,c,l,f,v;return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=e.transferData,o=a.amount,s=a.address,c=a.selectedAsset,o&&s&&c){r.next=3;break}return r.abrupt("return");case 3:if(C.value=!0,f=g(u.yv.ethereum),r.prev=5,k.value){r.next=12;break}return r.next=9,null===(t=P.transferToken)||void 0===t?void 0:t.call(P,o,s,c.contractId,{fromAccount:null===f||void 0===f?void 0:f.address,maxPriorityFeePerGas:e.transferData.maxPriorityFeePerGas,maxFeePerGas:e.transferData.maxFeePerGas});case 9:l=r.sent,r.next=15;break;case 12:return r.next=14,P.spend(Number(o),s,{fromAccount:null===f||void 0===f?void 0:f.address,maxPriorityFeePerGas:e.transferData.maxPriorityFeePerGas,maxFeePerGas:e.transferData.maxFeePerGas});case 14:l=r.sent;case 15:l&&(v={hash:l.hash,pending:!0,transactionOwner:null===f||void 0===f?void 0:f.address,protocol:u.yv.ethereum,tx:{amount:Number(o),callerId:null===f||void 0===f?void 0:f.address,contractId:c.contractId,senderId:null===f||void 0===f?void 0:f.address,type:k.value?"SpendTx":"ContractCallTx",function:"transfer",recipientId:s,arguments:[],fee:0}},b(null===f||void 0===f?void 0:f.address,v)),r.next=22;break;case 18:throw r.prev=18,r.t0=r["catch"](5),w(r.t0.message),r.t0;case 22:return r.prev=22,C.value=!1,r.finish(22);case 25:i.push({name:h.value}),n("success");case 27:case"end":return r.stop()}}),r,null,[[5,18,22,25]])})))}return{PROTOCOLS:u.yv,ETH_COIN_SYMBOL:p.xU,loading:C,isSelectedAssetEthCoin:k,submit:y}}});var g=n(66262);const O=(0,g.A)(T,[["render",l],["__scopeId","data-v-21c3bf53"]]),b=O;n(76918),n(23288),n(38781);var C=n(53751);function P(e,t,n,a,o,s){var u=(0,r.g2)("TransferSendRecipient"),c=(0,r.g2)("BtnMaxAmount"),i=(0,r.g2)("TransferSendAmount"),l=(0,r.g2)("TransactionSpeedPicker"),d=(0,r.g2)("DetailsItem"),f=(0,r.g2)("TransferSendFormBase");return(0,r.uX)(),(0,r.Wv)(f,(0,r.v6)(e.$attrs,{"transfer-data":e.transferData,fee:e.numericFee,"max-fee":e.numericMaxFee,"fee-symbol":e.ETH_COIN_SYMBOL,protocol:e.PROTOCOLS.ethereum,"custom-title":e.$t("modals.send.sendAsset",{name:e.ETH_PROTOCOL_NAME}),class:"transfer-send-form"}),{recipient:(0,r.k6)((function(){return[(0,r.bF)(u,{modelValue:e.formModel.address,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formModel.address=t}),modelModifiers:{trim:!0},placeholder:e.recipientPlaceholderText,errors:e.errors,protocol:e.PROTOCOLS.ethereum,"validation-rules":{account_address:[e.PROTOCOLS.ethereum]},onOpenQrModal:t[1]||(t[1]=function(t){return e.scanTransferQrCode()})},null,8,["modelValue","placeholder","errors","protocol","validation-rules"])]})),amount:(0,r.k6)((function(){return[(0,r.bF)(i,{modelValue:e.formModel.amount,"onUpdate:modelValue":[t[2]||(t[2]=function(t){return e.formModel.amount=t}),t[3]||(t[3]=function(t){return e.shouldUseMaxAmount=!1})],errors:e.errors,"selected-asset":e.formModel.selectedAsset,protocol:e.PROTOCOLS.ethereum,"blink-on-change":e.shouldUseMaxAmount,"validation-rules":Object.assign(Object.assign({},+e.balance.minus(e.maxFee)>0?{max_value:e.max}:{}),{enough_coin:[e.maxFee.toString(),e.ETH_COIN_SYMBOL]}),onAssetSelected:e.handleAssetChange},{"label-after":(0,r.k6)((function(){return[(0,r.bF)(c,{"is-max":e.shouldUseMaxAmount,onClick:e.toggleMaxAmount},null,8,["is-max","onClick"])]})),_:1},8,["modelValue","errors","selected-asset","protocol","blink-on-change","validation-rules","onAssetSelected"])]})),extra:(0,r.k6)((function(){return[(0,r.bo)((0,r.bF)(d,{label:e.$t("modals.send.transactionSpeed")},{value:(0,r.k6)((function(){return[(0,r.bF)(l,{modelValue:e.feeSelectedIndex,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.feeSelectedIndex=t}),"fee-list":e.feeList},null,8,["modelValue","fee-list"])]})),_:1},8,["label"]),[[C.aG,e.activeNetwork.type!==e.NETWORK_TYPE_TESTNET]])]})),_:1},16,["transfer-data","fee","max-fee","fee-symbol","protocol","custom-title"])}n(28706),n(50113),n(9868);var k=n(60346),w=n(6635),y=n(34620),E=n(91187);function D(e){var t=e.formModel,n=e.fee,a=(0,c.ty)(),o=a.balance,s=(0,r.EW)((function(){var e,n,r=m.C.getAdapter(u.yv.ethereum);return(null===(n=null===(e=t.value)||void 0===e?void 0:e.selectedAsset)||void 0===n?void 0:n.contractId)===r.coinContractId})),i=(0,r.EW)((function(){var e,n;return new k.A((0,E.Y9)(null===(e=t.value.selectedAsset)||void 0===e?void 0:e.amount,-((null===(n=t.value.selectedAsset)||void 0===n?void 0:n.decimals)||-0))||0)})),l=(0,r.EW)((function(){if(o.value&&s.value){var e=o.value.minus(n.value);return(e.isPositive()?e:0).toString()}return i.value.toString()}));return{max:l}}var F=n(36311),I=n(57870),_=n(10483),M=n(40114),R=n(18381),N=n(27481),L=n(2915),B=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function u(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):a(e.value).then(s,u)}c((r=r.apply(e,t||[])).next())}))};const W=(0,r.pM)({name:"EthTransferSendForm",components:{BtnMaxAmount:L.A,TransactionSpeedPicker:N.A,DetailsItem:x.A,TransferSendAmount:R.A,TransferSendRecipient:M.A,TransferSendFormBase:_.A},model:{prop:"transferData"},props:{transferData:{type:Object,required:!0}},emits:["update:transferData","success","error"],setup:function(e,t){var n=this,a=t.emit,o=(0,f.lq)(),i=(0,v.s9)(),l=i.t,h=(0,c.fI)(),x=h.activeNetwork,A=(0,c.ZN)(),S=A.marketData,T=(0,c.ty)(),g=T.balance,O=(0,c.oV)(),b=O.activeAccount,C=(0,w.u)(),P=C.fee,_=C.maxFee,M=C.feeList,R=C.feeSelectedIndex,N=C.maxFeePerGas,L=C.maxPriorityFeePerGas,W=C.updateFeeList,G=(0,c.Sr)(),V=G.accountAssets,j=(0,F.G)(),U=j.ethActiveNetworkSettings;function Y(e,t){return e?V.value.find((function(t){var n=t.contractId;return n===e})):t?void 0:m.C.getAdapter(u.yv.ethereum).getDefaultCoin(S.value,+g.value)}var H=(0,y.x)({transferData:e.transferData,getSelectedAssetValue:Y}),K=H.formModel,X=H.errors,Q=H.hasError,$=H.invoiceId,q=H.invoiceContract,z=H.scanTransferQrCode,Z=H.handleAssetChange,J=H.updateFormModelValues,ee=(0,s.KR)(!1),te=D({formModel:K,fee:_}),ne=te.max,re=(0,r.EW)((function(){return+P.value.toFixed()})),ae=(0,r.EW)((function(){return+_.value.toFixed()})),oe="".concat(l("modals.send.recipientPlaceholderProtocol",{name:u.yv.ethereum})," ").concat(l("modals.send.recipientPlaceholderENS"));function se(){var e,t,n,o=Object.assign(Object.assign({},K.value),{fee:P.value,maxFeePerGas:null===(e=N.value)||void 0===e?void 0:e.toFormat(p.hj),maxPriorityFeePerGas:null===(t=L.value)||void 0===t?void 0:t.toFormat(p.hj),total:re.value+ +((null===(n=K.value)||void 0===n?void 0:n.amount)||0),invoiceId:$.value,invoiceContract:q.value});return a("update:transferData",o),(0,r.dY)()}function ue(){return B(this,void 0,void 0,(0,d.A)().mark((function e(){return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Q.value){e.next=4;break}return e.next=3,se();case 3:a("success");case 4:case"end":return e.stop()}}),e)})))}function ce(){ee.value=!ee.value,ee.value&&(K.value.amount=ne.value)}function ie(){var t,n,r,a=new k.A(K.value.amount);if("ethereum"!==(null===(t=e.transferData.selectedAsset)||void 0===t?void 0:t.contractId)&&a.gt(0)&&K.value.address){var o=U.value.nodeUrl;return(0,I.b)(null===(n=K.value.selectedAsset)||void 0===n?void 0:n.contractId,K.value.address,null===(r=b.value)||void 0===r?void 0:r.address,a,o)}}var le=null;return(0,r.sV)((function(){var t;le=(0,E.mX)((function(){return B(n,void 0,void 0,(0,d.A)().mark((function e(){return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=W,e.next=3,ie();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))}),5e3);var r=o.query;J(Object.assign(Object.assign({},r),{token:r.token||(null===(t=e.transferData.selectedAsset)||void 0===t?void 0:t.contractId)}))})),(0,r.hi)((function(){le&&clearInterval(le)})),(0,r.wB)((function(){return K.value.selectedAsset}),(function(){return B(n,void 0,void 0,(0,d.A)().mark((function e(){return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=W,e.next=3,ie();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))})),(0,r.wB)(ne,(function(e){ee.value&&(K.value.amount=e)})),(0,r.wB)(Q,(function(e){return a("error",e)}),{deep:!0}),(0,r.wB)(K,(function(){se()}),{deep:!0}),{ETH_PROTOCOL_NAME:p.Dz,ETH_COIN_SYMBOL:p.xU,PROTOCOLS:u.yv,NETWORK_TYPE_TESTNET:u.Oj,formModel:K,activeNetwork:x,maxFee:_,feeList:M,recipientPlaceholderText:oe,feeSelectedIndex:R,numericFee:re,numericMaxFee:ae,errors:X,balance:g,max:ne,shouldUseMaxAmount:ee,scanTransferQrCode:z,handleAssetChange:Z,submit:ue,toggleMaxAmount:ce}}}),G=(0,g.A)(W,[["render",P]]),V=G,j=(0,r.pM)({name:u.iP,components:{TransferSendBase:i.A},props:Object.assign(Object.assign({},i.g),{tokenContractId:{type:String,default:null}}),setup:function(e){var t=(0,c.Y7)(),n=t.getProtocolAvailableTokens,a=(0,r.EW)((function(){return n(u.yv.ethereum)})),i=(0,s.KR)(),l=(0,s.KR)(u.x0.form),d=(0,s.KR)(!1),f=(0,s.KR)({address:e.address,amount:e.amount,payload:e.payload,selectedAsset:e.tokenContractId?a.value[e.tokenContractId]:void 0});function v(){i.value.submit()}function m(){l.value=u.x0.review}function p(){d.value=!1,l.value=u.x0.form}var h=(0,o.A)((0,o.A)({},u.x0.form,{component:V,onSuccess:m}),u.x0.review,{component:b,onSuccess:e.resolve}),x=(0,r.EW)((function(){return h[l.value]}));return{TRANSFER_SEND_STEPS:u.x0,currentRenderedComponent:i,steps:h,currentStep:l,error:d,transferData:f,currentStepConfig:x,proceedToNextStep:v,editTransfer:p}}}),U=(0,g.A)(j,[["render",a]]),Y=U}}]);